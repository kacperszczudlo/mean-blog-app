<div class="container mt-4">
    <div class="card p-3 mb-3">
        <div class="row g-3 align-items-end">
            <div class="col-md-3">
                <label class="form-label">Szukaj (tytuł/treść)</label>
                <input type="text" class="form-control form-control-sm" 
                       [(ngModel)]="filterText" 
                       (change)="onFilterChange()"
                       placeholder="Wpisz słowo kluczowe...">
            </div>
            <div class="col-md-3">
                <label class="form-label">Autor</label>
                <input type="text" class="form-control form-control-sm"
                       [(ngModel)]="authorFilter"
                       (change)="onFilterChange()"
                       placeholder="Nazwa lub ID autora">
            </div>
            <div class="col-md-2">
                <label class="form-label">Data od</label>
                <input type="date" class="form-control form-control-sm"
                       [(ngModel)]="dateFrom"
                       (change)="onFilterChange()">
            </div>
            <div class="col-md-2">
                <label class="form-label">Data do</label>
                <input type="date" class="form-control form-control-sm"
                       [(ngModel)]="dateTo"
                       (change)="onFilterChange()">
            </div>
            <div class="col-md-2">
                <label class="form-label">Kategoria</label>
                <select class="form-select form-select-sm" 
                        [(ngModel)]="selectedCategory" 
                        (change)="onCategoryChange(selectedCategory)">
                  <option value="all">Wszystkie</option>
                  @for (cat of categories.slice(1); track cat) {
                    <option [value]="cat">{{ cat }}</option>
                  }
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Sortowanie</label>
                <select class="form-select form-select-sm" [(ngModel)]="sortBy" (change)="applySorting()">
                    <option value="newest">Najnowsze</option>
                    <option value="oldest">Najstarsze</option>
                    <option value="popular">Najpopularniejsze (lajki)</option>
                    <option value="rating">Najwyżej oceniane</option>
                </select>
            </div>
        </div>
    </div>
    
    <div class="row">
        @for (item of (items$ | paginate: currentPage : itemsPerPage); track item._id) {
            
            <div class="col-12 col-md-6 col-lg-4 mb-4">
                <blog-item 
                    [title]="item.title" 
                    [text]="item.text" 
                    [image]="item.image"
                    [id]="item._id"
                    [authorId]="item.authorId"
                    [authorName]="item.authorName"
                    [category]="item.category"
                    [likes]="item.likes"
                    [likedBy]="item.likedBy"
                    [comments]="item.comments"
                    [averageRating]="item.averageRating"
                    [ratingsCount]="item.ratingsCount"
                    [createdAt]="item.createdAt"
                    [highlightTerm]="filterText"
                    (postDeleted)="getAll()"
                    (postUpdated)="getAll()">
                </blog-item>
            </div>

        } @empty {
            <div class="col-12">
                <div class="alert alert-warning" role="alert">
                    Brak wyników lub brak postów w ulubionych.
                </div>
            </div>
        }
    </div>

    <app-pagination
        [totalItems]="items$.length || 0"
        [currentPage]="currentPage"
        [itemsPerPage]="itemsPerPage"
        (pageChange)="onPageChange($event)">
    </app-pagination>
</div>