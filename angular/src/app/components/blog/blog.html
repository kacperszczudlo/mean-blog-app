<div class="container mt-4">
    <div class="card p-3 mb-3">
        <div class="row g-2 align-items-end">
            <div class="col-12 col-md-3">
                <label class="form-label">Tytuł / treść</label>
                <input class="form-control form-control-sm" [(ngModel)]="searchTitle" placeholder="Szukaj w treści...">
            </div>
            <div class="col-12 col-md-2">
                <label class="form-label">Autor</label>
                <input class="form-control form-control-sm" [(ngModel)]="searchAuthor" placeholder="Autor">
            </div>
            <div class="col-6 col-md-2">
                <label class="form-label">Od</label>
                <input type="date" class="form-control form-control-sm" [(ngModel)]="dateFrom">
            </div>
            <div class="col-6 col-md-2">
                <label class="form-label">Do</label>
                <input type="date" class="form-control form-control-sm" [(ngModel)]="dateTo">
            </div>
            <div class="col-12 col-md-3">
                <label class="form-label">Sortowanie</label>
                <select class="form-select form-select-sm" [(ngModel)]="sortBy" (change)="applyFilters()">
                    <option value="newest">Najnowsze</option>
                    <option value="oldest">Najstarsze</option>
                    <option value="popular">Najpopularniejsze (lajki)</option>
                    <option value="rating">Najwyżej oceniane</option>
                </select>
            </div>
        </div>
        <div class="d-flex flex-wrap gap-2 mt-3">
            <div>
                <label class="me-2">Kategoria:</label>
                <select class="form-select form-select-sm d-inline-block w-auto" 
                        [(ngModel)]="selectedCategory" 
                        (change)="onCategoryChange(selectedCategory)">
                  <option value="all">Wszystkie</option>
                  @for (cat of categories.slice(1); track cat) {
                    <option [value]="cat">{{ cat }}</option>
                  }
                </select>
            </div>
            <button class="btn btn-sm btn-primary" (click)="applyFilters()">
                Zastosuj filtry
            </button>
            <button class="btn btn-sm btn-outline-info" (click)="sortItemsByRating()">
                <i class="fa fa-sort"></i> Sortuj według ocen ⭐
            </button>
        </div>
    </div>
    
    <div class="row">
        @for (item of (items$ | filter: filterText | paginate: currentPage : itemsPerPage); track item._id) {
            
            <div class="col-12 col-md-6 col-lg-4 mb-4">
                <blog-item 
                    [title]="item.title" 
                    [text]="item.text" 
                    [image]="item.image"
                    [id]="item._id"
                    [authorId]="item.authorId"
                    [authorName]="item.authorName"
                    [category]="item.category"
                    [likes]="item.likes"
                    [likedBy]="item.likedBy"
                    [comments]="item.comments"
                    [averageRating]="item.averageRating"
                    [ratingsCount]="item.ratingsCount"
                    [createdAt]="item.createdAt"
                    (postDeleted)="getAll()"
                    (postUpdated)="getAll()">
                </blog-item>
            </div>

        } @empty {
            <div class="col-12">
                <div class="alert alert-warning" role="alert">
                    Brak wyników lub brak postów w ulubionych.
                </div>
            </div>
        }
    </div>

    <app-pagination
        [totalItems]="(items$ | filter: filterText)?.length || 0"
        [currentPage]="currentPage"
        [itemsPerPage]="itemsPerPage"
        (pageChange)="onPageChange($event)">
    </app-pagination>
</div>